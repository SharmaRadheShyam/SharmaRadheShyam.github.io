#include<XnCppWrapper.h>
#include<stdio.h>



void main()
{
  XnStatus nRetVal = XN_STATUS_OK;
   xn:: Context context;
  nRetVal = context.Init();
// TODO: check error code
// Create a depth generator
xn::DepthGenerator depth;
nRetVal = depth.Create(context);
// TODO: check error code
// Set it to VGA maps at 30 FPS
XnMapOutputMode mapMode;
mapMode.nXRes = XN_VGA_X_RES;
mapMode.nYRes = XN_VGA_Y_RES;
mapMode.nFPS = 30;
nRetVal = depth.SetMapOutputMode(mapMode);
// TODO: check error code
// Start generating
nRetVal = context.StartGeneratingAll();
// TODO: check error code
// Calculate index of middle pixel
XnUInt32 nMiddleIndex = 
XN_VGA_X_RES * XN_VGA_Y_RES/2 + // start of middle line
XN_VGA_X_RES/2;   // middle of this line
while (TRUE)
{
// Update to next frame
nRetVal = context.WaitOneUpdateAll(depth);
// TODO: check error code

const XnDepthPixel* pDepthMap = depth.GetDepthMap();
printf("Middle pixel is %u millimeters away\n", 
pDepthMap[nMiddleIndex]);
}
// Clean up
context.Shutdown();
}

